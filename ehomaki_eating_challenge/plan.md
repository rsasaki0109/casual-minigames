# 恵方を向いて、最後まで食べ切れチャレンジ - 設計書

## 1. ゲーム概要

節分の日、プレイヤーは恵方巻を手に持ち、恵方（2025年は西南西）を向いて黙って食べ切ることを目指すミニゲーム。しかし、周囲から「恵方巻泥棒」たちが次々と現れ、プレイヤーの恵方巻を奪おうとする。

プレイヤーは恵方巻を食べ進めながら、迫りくる泥棒たちを撃退し、恵方巻を最後まで食べ切ればクリア。泥棒に恵方巻を奪われるとゲームオーバーとなる。

## 2. ゲームルール

- プレイヤーは画面中央に固定され、恵方巻を自動で食べ続ける
- 恵方巻には「残り量ゲージ」があり、時間経過で減少していく
- 残り量ゲージが0になるとクリア
- 画面の四方から「恵方巻泥棒」が出現し、プレイヤーに向かってくる
- プレイヤーはマウスクリック（またはキー入力）で「にらみ」を発動し、泥棒を撃退できる
- 泥棒がプレイヤーに接触すると、恵方巻を奪われてゲームオーバー
- 「にらみ」は全方位ではなく、マウスカーソルの方向のみに効果がある
- にらみには短いクールダウン（0.3秒）がある

## 3. 画面構成

### 3.1 タイトル画面

| 要素 | 内容 |
|------|------|
| タイトルロゴ | 「恵方を向いて、最後まで食べ切れチャレンジ」 |
| 恵方表示 | 「2025年の恵方：西南西」 |
| スタートボタン | 「ゲームスタート」（クリックでゲーム開始） |
| 遊び方ボタン | 「遊び方」（クリックで説明モーダル表示） |
| ハイスコア表示 | ローカルストレージから取得した最高スコア |

### 3.2 ゲーム画面

```
+--------------------------------------------------+
|  スコア: 12340     残り: ████████░░ 80%          |
+--------------------------------------------------+
|                                                  |
|        泥棒→                                     |
|                    ┌─────┐                       |
|                    │ 🧑  │  ←プレイヤー          |
|         ↑         │ 🍣  │                       |
|        泥棒        └─────┘     ←泥棒             |
|                        ↑                        |
|                     にらみ範囲（扇形）            |
|                                                  |
+--------------------------------------------------+
|  [一時停止]                                       |
+--------------------------------------------------+
```

| 要素 | 詳細 |
|------|------|
| スコア表示 | 画面左上、リアルタイム更新 |
| 残り量ゲージ | 画面上部中央、恵方巻の残り量を%とバーで表示 |
| プレイヤー | 画面中央固定、恵方巻を持った人物 |
| にらみ範囲 | マウスカーソル方向に45度の扇形で表示 |
| 泥棒 | 画面端から出現、プレイヤーに向かって移動 |
| 一時停止ボタン | 画面左下、クリックでポーズ |

### 3.3 リザルト画面

| 要素 | 内容 |
|------|------|
| 結果表示 | 「クリア！」または「ゲームオーバー...」 |
| 最終スコア | 獲得したスコアの合計 |
| 統計情報 | 撃退した泥棒の数、経過時間 |
| ハイスコア | 新記録の場合は「NEW RECORD!」表示 |
| リトライボタン | 「もう一度遊ぶ」 |
| タイトルボタン | 「タイトルに戻る」 |

## 4. 操作方法（PC前提）

| 操作 | 入力方法 | 効果 |
|------|----------|------|
| にらみの方向指定 | マウス移動 | マウスカーソルの方向ににらみ範囲が向く |
| にらみ発動 | 左クリック or スペースキー | にらみ範囲内の泥棒を撃退 |
| 一時停止 | Escキー or 一時停止ボタン | ゲームを一時停止 |
| リスタート | Rキー（リザルト画面のみ） | ゲームをリトライ |

## 5. スコア設計

### 5.1 スコア獲得条件

| 条件 | 獲得スコア |
|------|-----------|
| 泥棒を撃退 | 100点 × 現在の倍率 |
| 恵方巻を1%食べる | 50点 |
| クリアボーナス | 5000点 |
| 連続撃退ボーナス | 2秒以内に連続撃退で倍率上昇（最大5倍） |

### 5.2 倍率システム

- 初期倍率: 1.0倍
- 2秒以内に次の撃退: 倍率 +0.5（最大5.0倍）
- 2秒間撃退なし: 倍率リセット（1.0倍に戻る）

### 5.3 ハイスコア保存

- ローカルストレージに保存
- キー名: `ehomaki_highscore`
- クリア時のスコアのみ記録対象

## 6. 敵（恵方巻泥棒）の仕様

### 6.1 基本パラメータ

| パラメータ | 初期値 | 説明 |
|-----------|--------|------|
| 移動速度 | 80px/秒 | プレイヤーに向かう速度 |
| 出現間隔 | 2.0秒 | 次の泥棒が出現するまでの間隔 |
| 当たり判定 | 半径30px | 円形の当たり判定 |
| 撃退判定 | にらみ範囲内 | 扇形45度、半径150px |

### 6.2 出現ロジック

1. 画面の四辺（上下左右）からランダムに出現位置を決定
2. 出現位置は画面端から20px外側
3. 出現時、プレイヤーとの角度に若干のランダム性（±15度）を持たせる
4. 同時に画面上に存在できる泥棒の最大数: 8体

### 6.3 移動パターン

- 基本: プレイヤーに向かって直進
- 移動中に微小なランダム揺れ（±5度/秒）を加える
- プレイヤーに接触（プレイヤー半径20px + 泥棒半径30px = 50px以内）でゲームオーバー

### 6.4 撃退時の挙動

1. にらみ範囲内に入った状態でクリック
2. 泥棒が「びっくりエフェクト」を表示
3. 出現した方向に向かって高速で退場（300px/秒）
4. 画面外に出たら削除

## 7. 難易度設計

### 7.1 時間経過による変化

| 経過時間 | 出現間隔 | 移動速度 | 同時出現数上限 |
|----------|----------|----------|----------------|
| 0〜10秒 | 2.0秒 | 80px/秒 | 2体 |
| 10〜20秒 | 1.5秒 | 100px/秒 | 3体 |
| 20〜30秒 | 1.2秒 | 120px/秒 | 4体 |
| 30〜45秒 | 1.0秒 | 140px/秒 | 5体 |
| 45〜60秒 | 0.8秒 | 160px/秒 | 6体 |
| 60秒〜 | 0.6秒 | 180px/秒 | 8体 |

### 7.2 恵方巻の消費速度

- 基本消費速度: 1%/秒（60秒でクリア可能）
- 恵方巻の総量: 100%
- クリアまでの標準時間: 約60秒

### 7.3 バランス調整用定数

```
GAME_DURATION = 60          // クリアまでの秒数
GLARE_COOLDOWN = 0.3        // にらみのクールダウン秒数
GLARE_ANGLE = 45            // にらみの範囲角度（度）
GLARE_RANGE = 150           // にらみの届く距離（px）
PLAYER_RADIUS = 20          // プレイヤーの当たり判定半径
ENEMY_RADIUS = 30           // 泥棒の当たり判定半径
```

## 8. 技術構成

### 8.1 使用技術

| 技術 | 用途 |
|------|------|
| HTML5 | ページ構造 |
| CSS3 | スタイリング、アニメーション |
| JavaScript (ES6+) | ゲームロジック |
| Canvas API | ゲーム描画 |
| LocalStorage API | ハイスコア保存 |
| GitHub Pages | ホスティング |

### 8.2 ファイル構成

```
ehomaki_eating_challenge/
├── index.html          # エントリーポイント
├── css/
│   └── style.css       # 全体スタイル
├── js/
│   ├── main.js         # エントリーポイント、初期化
│   ├── game.js         # ゲームループ、状態管理
│   ├── player.js       # プレイヤークラス
│   ├── enemy.js        # 泥棒クラス
│   ├── ui.js           # UI描画、スコア表示
│   └── utils.js        # 共通ユーティリティ関数
├── assets/
│   └── images/         # 画像素材（必要に応じて）
└── README.md           # プロジェクト説明
```

### 8.3 Canvasの役割

| レイヤー | 描画内容 |
|----------|----------|
| 背景 | 畳風の背景パターン |
| ゲームオブジェクト | プレイヤー、泥棒、にらみ範囲 |
| エフェクト | 撃退時のエフェクト、スコアポップアップ |
| UI | スコア、残り量ゲージ（DOM併用可） |

#### Canvas設計

- サイズ: 800px × 600px（レスポンシブ対応でscale）
- フレームレート: 60fps（requestAnimationFrame使用）
- 座標系: 左上原点、右がX正、下がY正

## 9. 実装の優先順位（MVP）

### Phase 1: 基本構造（最優先）

1. HTML/CSSの基本構造作成
2. Canvas初期化とゲームループ実装
3. プレイヤーの描画（中央固定）
4. マウス追従によるにらみ方向の表示

### Phase 2: コアゲームプレイ

5. 泥棒の出現と移動ロジック
6. にらみによる撃退判定
7. 泥棒との接触判定（ゲームオーバー）
8. 恵方巻の残り量ゲージと自動消費

### Phase 3: ゲームフロー

9. タイトル画面の実装
10. リザルト画面の実装
11. 画面遷移の実装

### Phase 4: スコアとUI

12. スコアシステムの実装
13. 倍率システムの実装
14. ハイスコア保存機能

### Phase 5: 難易度調整

15. 時間経過による難易度変化
16. ゲームバランス調整

### Phase 6: ポリッシュ

17. エフェクトの追加
18. サウンド対応（任意）
19. レスポンシブ対応

## 10. 将来的な拡張案

| 拡張案 | 概要 |
|--------|------|
| 複数の恵方巻 | 海鮮巻、サラダ巻など種類を選択可能に |
| パワーアップアイテム | 一時的に全方位にらみ、無敵など |
| 泥棒のバリエーション | 速い泥棒、ジグザグ移動、フェイント泥棒 |
| ステージ制 | 複数ステージ、ボス泥棒の実装 |
| ランキング機能 | オンラインランキング（Firebase等） |
| モバイル対応 | タッチ操作への対応 |
| 実績システム | 「100人撃退」「ノーミスクリア」などの実績 |
| BGM・SE追加 | 雰囲気を出す音声の追加 |
